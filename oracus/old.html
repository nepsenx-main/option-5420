
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" type="image/png" href="https://assets.onecompiler.app/438cc35sk/43ekedjqg/Screenshot_2025-04-12_175711-Photoroom-fotor-20250412183519-removebg-preview.png">
<title>NeoDot</title>
<meta name="description" content="NeoDot is a lightweight web-based chatbot. It responds to user inputs using predefined logic‚Äîno AI required!">
<meta name="keywords" content="chatbot, web chatbot, NeoDot, JavaScript chatbot, simple chat">
<meta name="author" content="NepsenX">
<meta name="robots" content="index, follow">  <!-- Allow search engines to index -->

<!-- OpenGraph (Social Media Sharing) -->
<meta property="og:title" content="NeoDot - A Simple Web Chatbot">
<meta property="og:description" content="Chat with NeoDot, a lightweight JavaScript-based chatbot. No AI‚Äîjust fun logic!">
<meta property="og:url" content="https://wizstu.github.io/NeoDot/dot.html">
<script src="https://NepsenX.github.io/ishahi/auto-offline.js"></script>
<meta property="og:type" content="website">
<!-- Optional: Add a screenshot of your chatbot for social previews -->
<!-- <meta property="og:image" content="https://wizstu.github.io/NeoDot/images/neodot-preview.png"> -->

<!-- Twitter Card (Optional) -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NeoDot - A Simple Web Chatbot">
<meta name="twitter:description" content="Try this lightweight JavaScript chatbot!">
<!-- <meta name="twitter:image" content="https://wizstu.github.io/NeoDot/images/neodot-preview.png"> -->
<style>
:root {
  --primary-color: #2563eb;
  --primary-dark: #1e40af;
  --bg-color: #ffffff;
  --text-color: #1e293b;
  --border-color: #e2e8f0;
  --message-bg: #f8fafc;
  --user-message-bg: #f1f5f9;
  --sidebar-bg: #f7f7f8;
  --sidebar-text: #334155;
  --input-bg: #f8fafc;
  --scrollbar-thumb: #cbd5e1;
  --scrollbar-track: #f1f5f9;
  --nav-bg: #ffffff;
}

[data-theme="dark"] {
  --primary-color: #3b82f6;
  --primary-dark: #1d4ed8;
  --bg-color: #1e293b;
  --text-color: #f8fafc;
  --border-color: #334155;
  --message-bg: #334155;
  --user-message-bg: #475569;
  --sidebar-bg: #0f172a;
  --sidebar-text: #e2e8f0;
  --input-bg: #334155;
  --scrollbar-thumb: #475569;
  --scrollbar-track: #1e293b;
  --nav-bg: #1e293b;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
  transition: background-color 0.3s, color 0.3s, border-color 0.3s;
}

  body {
        overflow-x: hidden;
        overflow-y: transparent; 
  background: var(--sidebar-bg);
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* Mobile Navigation Bar */
.mobile-nav {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--nav-bg);
  border-top: 1px solid var(--border-color);
  padding: 8px 0;
  z-index: 1000;
}

.mobile-nav-buttons {
  display: flex;
  justify-content: space-around;
}

.mobile-nav-btn {
  background: none;
  border: none;
  color: var(--text-color);
  padding: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 12px;
  cursor: pointer;
}

.mobile-nav-btn svg {
  width: 24px;
  height: 24px;
  margin-bottom: 4px;
}

/* Sidebar */
.sidebar {
  width: 260px;
  background: var(--sidebar-bg);
  color: var(--sidebar-text);
  padding: 16px;
  display: flex;
  flex-direction: column;
  border-right: 1px solid var(--border-color);
  overflow-y: auto;
  z-index: 100;
  position: relative;
}

.sidebar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-color);
}

.new-chat-btn {
  background: var(--primary-color);
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.new-chat-btn:hover {
  background: var(--primary-dark);
}

.conversation-list {
  flex: 1;
  overflow-y: auto;
}

.conversation-item {
  padding: 10px 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  cursor: pointer;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.conversation-item:hover {
  background: rgba(255, 255, 255, 0.1);
}

.conversation-item.active {
  background: var(--primary-color);
  color: white;
}

.sidebar-footer {
  padding-top: 16px;
  border-top: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.theme-toggle {
  background: none;
  border: none;
  color: var(--sidebar-text);
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.theme-toggle:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* Main chat area */
.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: var(--bg-color);
  position: relative;
}

.header {
  background: var(--bg-color);
  color: var(--text-color);
  padding: 16px 24px;
  font-size: 20px;
  font-weight: 600;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  gap: 10px;
}

.header .logo {
  width: 28px;
  height: 28px;
}

.messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding-bottom: 80px; /* Space for mobile nav */
}

.messages p {
  padding: 16px 20px;
  border-radius: 12px;
  max-width: 85%;
  word-wrap: break-word;
  font-size: 16px;
  line-height: 1.6;
}

.messages .user {
  background: var(--user-message-bg);
  color: var(--text-color);
  align-self: flex-end;
  border-radius: 12px 12px 0 12px;
  border: 1px solid var(--border-color);
}

.messages .bot {
  background: var(--message-bg);
  color: var(--text-color);
  align-self: flex-start;
  border-radius: 12px 12px 12px 0;
  border: 1px solid var(--border-color);
}
/* Special message types */
.weather-alert {
  background: var(--weather-bg);
  border: 1px solid var(--primary-color);
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
  color: var(--text-color); /* Set text color */
}

.earthquake-alert {
  background: var(--earthquake-bg);
  border: 1px solid #ff4d4f;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
  color: var(--text-color); /* Set text color */
}

.alert-title {
  font-weight: 600;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.weather-icon {
  width: 24px;
  height: 24px;
}

.weather-details {
  display: flex;
  gap: 16px;
  margin-top: 8px;
}

.weather-detail {
  display: flex;
  align-items: center;
  gap: 4px;
}

.weather-map {
  width: 100%;
  height: 200px;
  border-radius: 8px;
  margin-top: 12px;
  border: 1px solid var(--border-color);
}

.earthquake-details {
  margin-top: 8px;
}

.earthquake-item {
  padding: 8px 0;
  border-bottom: 1px solid rgba(255, 77, 79, 0.2);
}

.earthquake-magnitude {
  font-weight: 600;
  color: #ff4d4f;
}

.content-section {
  margin-top: 16px;
  border-radius: 8px;
  overflow: hidden;
}

.media-section {
  margin-top: 16px;
}

.wikipedia-container {
  background: var(--message-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 16px;
  colour:var(--primary-color)
  margin-top: 16px;
}

.wikipedia-title {
  font-weight: 600;
  color: var(--primary-color);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.wikipedia-logo {
  width: 20px;
  height: 20px;
}

.wikipedia-text {
  color: var(--text-color);
  line-height: 1.6;
}

.image-container {
  display: flex;
  gap: 12px;
  margin-top: 16px;
  overflow-x: auto;
  padding-bottom: 8px;
}

.image-container img {
  max-width: 180px;
  height: auto;
  border-radius: 8px;
  border: 1px solid var(--border-color);
  cursor: pointer;
}

.video-container {
  margin-top: 16px;
  border-radius: 8px;
  overflow: hidden;
  background: var(--bg-secondary);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.video-container iframe {
  border: none;
  border-radius: 8px 8px 0 0;
  width: 100%;
  min-height: 320px;
  display: block;
}

.video-info {
  padding: 12px;
  font-size: 14px;
  color: var(--text-color);
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  background: var(--bg-secondary);
  border-radius: 0 0 8px 8px;
}

.video-info span {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-right: 12px;
}

.video-info svg {
  opacity: 0.8;
}

.download-options {
  margin-left: auto;
  display: flex;
  gap: 8px;
}

.download-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background-color: var(--primary-dark);
  color: white;
  text-decoration: none;
  padding: 0.6rem 1.2rem;
  border-radius: 0.5rem;
  font-weight: 500;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

.download-btn:hover {
  background-color: var(--primary-colour-hover, #005bb5); /* Optional fallback hover color */
  transform: translateY(-2px);
}

.download-btn span {
  display: inline-block;
}

.download-btn svg {
  fill: currentColor;
  display: inline-block;
}

.more-options {
  position: relative;
}

.more-options-btn {
  padding: 6px 12px;
  background: var(--bg-tertiary);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}

.options-dropdown {
  position: absolute;
  right: 0;
  top: 100%;
  background: var(--bg-primary);
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  padding: 8px 0;
  min-width: 160px;
  z-index: 10;
  display: none;
}

.more-options:hover .options-dropdown {
  display: block;
}

.download-option {
  display: block;
  padding: 8px 16px;
  color: var(--text-color);
  text-decoration: none;
}

.download-option:hover {
  background: var(--bg-secondary);
}

.answer-content {
  padding: 16px;
}

.answer-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.answer-header h3 {
  margin: 0;
  font-size: 18px;
}

.answer-icon {
  width: 24px;
  height: 24px;
  fill: var(--primary-color);
}

.answer-text {
  line-height: 1.5;
  margin-bottom: 16px;
}

.answer-media {
  margin-bottom: 16px;
}

.answer-media img {
  max-width: 100%;
  border-radius: 8px;
}

.answer-video {
  margin-top: 24px;
}

.input-container {
  display: flex;
  padding: 16px;
  background: var(--bg-color);
  border-top: 1px solid var(--border-color);
  position: fixed;
  bottom: 0;
  left: 260px;
  right: 0;
  z-index: 90;
}

.input-container input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid var(--border-color);
  border-radius: 12px;
  outline: none;
  font-size: 16px;
  background: var(--input-bg);
  color: var(--text-color);
}

.input-container input:focus {
  border-color: var(--primary-color);
}

.input-container button {
  padding: 12px 24px;
  border: none;
  background: var(--primary-color);
  color: white;
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
  margin-left: 12px;
  font-weight: 500;
}

.input-container button:hover {
  background: var(--primary-dark);
}

.typing-indicator {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 16px 20px;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: var(--text-color);
  opacity: 0.6;
  border-radius: 50%;
  animation: typingAnimation 1.4s infinite ease-in-out;
}

@keyframes typingAnimation {
  0%, 60%, 100% {
    transform: translateY(0);
    opacity: 0.6;
  }
  30% {
    transform: translateY(-4px);
    opacity: 1;
  }
}

.messages::-webkit-scrollbar {
  width: 6px;
}

.messages::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb);
  border-radius: 8px;
}

.messages::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
  border-radius: 8px;
}

.sidebar::-webkit-scrollbar {
  width: 6px;
}

.sidebar::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb);
  border-radius: 8px;
}

.sidebar::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
  border-radius: 8px;
}

@keyframes fadeIn {
  0% {
    opacity: 0;
    transform: translateY(10px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.messages > div {
  animation: fadeIn 0.3s ease-out forwards;
}

/* Mobile styles */
@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: -260px;
    top: 0;
    bottom: 0;
    transition: transform 0.3s ease;
    z-index: 1000;
  }
  
  .sidebar.open {
    transform: translateX(260px);
  }
  .messages{
    max-height: 86%;
  }
  .chat-container {
    margin-left: 0;
  }
  
  .input-container {
    left: 0;
    bottom: 60px; /* Above mobile nav */
  }
  
  .mobile-nav {
    display: block;
  }
  
  .mobile-menu-btn {
    display: flex;
    position: fixed;
    left: 10px;
    top: 10px;
    z-index: 1100;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }
}

/* Mobile menu button (hidden by default) */
.mobile-menu-btn {
  display: none;
}

/* Floating Language Button - Top Right */
.language-toggle {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--background);
  color: #fff;
  border: none;
  border-radius: 8px; /* Changed from circle to rounded rectangle */
  width: auto; /* Changed from fixed size to auto */
  height: auto;
  padding: 8px 12px;
  font-size: 1rem;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: 0.3s ease;
  z-index: 999;
  display: flex;
  align-items: center;
  gap: 8px;
}

.language-toggle:hover {
  background: #3367d6;
}

/* Google Translate Container - Below the button */
#google_translate_element {
  position: fixed;
  top: 60px; /* Position below the button */
  right: 20px; /* Align with the button */
  z-index: 998;
  background: var(--card-bg);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  padding: 0.75rem;
  display: none;
}

/* Style Google Translate dropdown */
#google_translate_element select {
  font-size: 1rem !important;
  padding: 0.5rem !important;
  border-radius: 2px !important;
  border: 1px solid #ccc !important;
  background-color: var(--card-bg) !important;
  color: var(--text-color) !important;
  max-width: 100%;
  width: 100% !important;
}

/* Reset unwanted Google Translate styles */
iframe.goog-te-banner-frame,
.goog-te-balloon-frame,
.goog-te-menu-frame {
  max-width: 100vw !important;
  box-sizing: border-box !important;
}

/* Fix iframe and dropdown on mobile */
@media (max-width: 600px) {
  .language-toggle {
    padding: 6px 10px;
    font-size: 0.9rem;
  }

  #google_translate_element {
    width: calc(100vw - 40px);
    max-width: 300px;
    padding: 0.5rem;
    font-size: 0.9rem;
  }

  #google_translate_element select {
    font-size: 1rem !important;
  }
}
</style>
</head>
<body>
  <button class="language-toggle" id="langToggleBtn">üåê</button>
  <div id="google_translate_element"></div>
  <button class="mobile-menu-btn" id="mobileMenuBtn">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M3 18H21V16H3V18ZM3 13H21V11H3V13ZM3 6V8H21V6H3Z" fill="white"/>
    </svg>
  </button>

  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button class="new-chat-btn" id="newChatBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 6V12M12 12V18M12 12H18M12 12H6" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
        New Chat
      </button>
    </div>
    <div class="conversation-list" id="conversationList">
      <!-- Conversations will be added here -->
    </div>
    <div class="sidebar-footer">
      <button class="theme-toggle" id="themeToggle">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 3V4M12 20V21M21 12H20M4 12H3M18.364 18.364L17.656 17.656M6.344 6.344L5.636 5.636M18.364 5.636L17.656 6.344M6.344 17.656L5.636 18.364M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span id="themeText">Dark Mode</span>
      </button>
    </div>
  </div>

  <div class="chat-container">
    <div class="header">
      <svg class="logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C6.477 2 2 6.477 2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2Z" fill="var(--primary-color)"/>
        <path d="M12 6C8.686 6 6 8.686 6 12C6 15.314 8.686 18 12 18C15.314 18 18 15.314 18 12C18 8.686 15.314 6 12 6Z" fill="white"/>
        <path d="M12 10C10.895 10 10 10.895 10 12C10 13.105 10.895 14 12 14C13.105 14 14 13.105 14 12C14 10.895 13.105 10 12 10Z" fill="var(--primary-color)"/>
      </svg>
      <span id="chatTitle">New Chat</span>
    </div>
    <div class="messages" id="messages">
      <!-- Messages will be loaded here -->
    </div>
    <div class="input-container">
      <input id="userInput" placeholder="Tell me any topic name..." type="text" onkeypress="handleKeyPress(event)" />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <!-- Mobile Navigation Bar -->
  <div class="mobile-nav">
    <div class="mobile-nav-buttons">
      <button class="mobile-nav-btn" id="mobileSidebarToggle">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 18H21V16H3V18ZM3 13H21V11H3V13ZM3 6V8H21V6H3Z" fill="currentColor"/>
        </svg>
        <span>Menu</span>
      </button>
      <button class="mobile-nav-btn" id="mobileNewChatBtn">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 6V12M12 12V18M12 12H18M12 12H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span>New Chat</span>
      </button>
      <button class="mobile-nav-btn" id="mobileThemeToggle">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 3V4M12 20V21M21 12H20M4 12H3M18.364 18.364L17.656 17.656M6.344 6.344L5.636 5.636M18.364 5.636L17.656 6.344M6.344 17.656L5.636 18.364M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span id="mobileThemeText">Theme</span>
      </button>
    </div>
  </div>


<script>
// YouTube video search API with API key support
    // YouTube video search API with API key support
    async function searchYouTubeVideos(query) {
      const CACHE_DURATION = 60 * 60 * 1000; // 1 hour cache
      const cacheKey = `yt_${encodeURIComponent(query)}`;
      
      // Check cache first
      const cached = localStorage.getItem(cacheKey);
      if (cached) {
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp < CACHE_DURATION) {
          return data;
        }
      }
    
      try {
        const YOUTUBE_API_KEY = "AIzaSyAqXHbNakvVR_SCW3_HgEaycrO2oL89URA"; // Consider replacing with your own key
        
        // Add timeout and abort controller
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 8000);
        
        // First search for most relevant videos
        const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=5&q=${encodeURIComponent(query)}&type=video&key=${YOUTUBE_API_KEY}`;
        const searchResponse = await fetch(searchUrl, { signal: controller.signal });
        clearTimeout(timeout);
        
        if (!searchResponse.ok) {
          throw new Error(`YouTube API error: ${searchResponse.status}`);
        }
        
        const searchData = await searchResponse.json();
        
        // Check for API errors
        if (searchData.error) {
          throw new Error(searchData.error.message);
        }
        
        if (!searchData.items || searchData.items.length === 0) {
          return [];
        }
    
        // Get video details in parallel with timeout
        const videoDetails = await Promise.all(
          searchData.items.map(async item => {
            try {
              const detailsController = new AbortController();
              const detailsTimeout = setTimeout(() => detailsController.abort(), 8000);
              
              const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet,contentDetails&id=${item.id.videoId}&key=${YOUTUBE_API_KEY}`;
              const detailsResponse = await fetch(detailsUrl, { signal: detailsController.signal });
              clearTimeout(detailsTimeout);
              
              if (!detailsResponse.ok) {
                console.error(`Failed to get details for video ${item.id.videoId}`);
                return null;
              }
              
              const detailsData = await detailsResponse.json();
              return detailsData.items?.[0] || null;
            } catch (error) {
              console.error(`Error fetching video details for ${item.id.videoId}:`, error);
              return null;
            }
          })
        ).then(results => results.filter(Boolean)); // Filter out failed requests
    
        if (videoDetails.length === 0) {
          return [];
        }
    
        // Format the videos
        const videos = videoDetails.map(video => ({
          id: video.id,
          title: video.snippet.title,
          channel: video.snippet.channelTitle,
          views: parseInt(video.statistics.viewCount).toLocaleString() + " views",
          likes: parseInt(video.statistics.likeCount || 0).toLocaleString(),
          duration: video.contentDetails.duration,
          thumbnail: video.snippet.thumbnails?.high?.url,
          url: `https://www.youtube.com/watch?v=${video.id}`,
          publishedAt: video.snippet.publishedAt
        }));
    
        // Sort by relevance
        const sortedVideos = videos.sort((a, b) => {
          const scoreA = calculateRelevanceScore(a);
          const scoreB = calculateRelevanceScore(b);
          return scoreB - scoreA;
        });
    
        // Cache the results
        localStorage.setItem(cacheKey, JSON.stringify({
          data: sortedVideos,
          timestamp: Date.now()
        }));
    
        return sortedVideos;
      } catch (error) {
        console.error("YouTube search error:", error);
        
        // Return cached results even if stale when there's an error
        if (cached) {
          return JSON.parse(cached).data;
        }
        
        return [];
      }
    }

    // Calculate a relevance score for videos (unchanged)
    function calculateRelevanceScore(video) {
      const daysOld = (new Date() - new Date(video.publishedAt)) / (1000 * 60 * 60 * 24);
      const recencyScore = Math.max(0, 30 - daysOld) / 30;
      
      const likeCount = parseInt(video.likes.replace(/\D/g, '')) || 0;
      const viewCount = parseInt(video.views.replace(/\D/g, '')) || 1;
      const engagementScore = likeCount / viewCount;
      
      const viewsScore = Math.log(viewCount + 1) / 10;
      
      return (recencyScore * 0.4) + (engagementScore * 0.4) + (viewsScore * 0.2);
    }
    
    // Format duration (unchanged)
    function formatDuration(duration) {
      const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      const hours = (parseInt(match[1]) || 0);
      const minutes = (parseInt(match[2]) || 0);
      const seconds = (parseInt(match[3]) || 0);
      
      return [
        hours.toString().padStart(hours > 0 ? 2 : 0, '0'),
        minutes.toString().padStart(2, '0'),
        seconds.toString().padStart(2, '0')
      ].filter(Boolean).join(':');
    }
    
    // Viewport and visibility functions (unchanged)
    function isInViewport(element) {
      const rect = element.getBoundingClientRect();
      return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
      );
    }
    
    function handleVideoVisibility() {
      document.querySelectorAll('.video-container iframe').forEach(video => {
        video.style.opacity = isInViewport(video) ? '1' : '0.5';
      });
    }


    // Add scroll event listener for video visibility
    document.addEventListener('DOMContentLoaded', () => {
      window.addEventListener('scroll', handleVideoVisibility);
      window.addEventListener('resize', handleVideoVisibility);
    });

    // Get user's IP address and location
    async function getUserLocation() {
      try {
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        const ip = ipData.ip || 'Unknown';
        
        const locationResponse = await fetch(`https://ipapi.co/${ip}/json/`);
        const locationData = await locationResponse.json();
        
        return {
          ip: ip,
          city: locationData.city || 'Dhaka',
          country: locationData.country_name || 'Bangladesh'
        };
      } catch (error) {
        console.error("Error fetching location:", error);
        return {
          ip: 'Unknown',
          city: 'Dhaka',
          country: 'Bangladesh'
        };
      }
    }

    // Get weather data
    async function getWeatherData(city = 'Dhaka') {
      try {
        // First get coordinates for the city
        const geoResponse = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`);
        const geoData = await geoResponse.json();
        
        if (geoData.results && geoData.results.length > 0) {
          const { latitude, longitude } = geoData.results[0];
          
          // Then get weather data
          const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`);
          const weatherData = await weatherResponse.json();
          
          return {
            ...weatherData,
            city: city
          };
        }
        
        // Fallback to Dhaka if city not found
        const fallbackResponse = await fetch('https://api.open-meteo.com/v1/forecast?latitude=23.8103&longitude=90.4125&current_weather=true');
        const fallbackData = await fallbackResponse.json();
        
        return {
          ...fallbackData,
          city: 'Dhaka'
        };
      } catch (error) {
        console.error("Error fetching weather:", error);
        return null;
      }
    }

    // Get earthquake data
    async function getEarthquakeData() {
      try {
        // Using USGS earthquake API
        const response = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_day.geojson');
        const data = await response.json();
        return data.features.slice(0, 3); // Get top 3 recent earthquakes
      } catch (error) {
        console.error("Error fetching earthquake data:", error);
        return [];
      }
    }

    // Local storage for conversations
    let conversations = JSON.parse(localStorage.getItem('conversations')) || [];
    let currentConversationId = null;
    let userLocation = {
      ip: 'Unknown',
      city: 'Dhaka',
      country: 'Bangladesh'
    };
    let lastWeatherUpdate = 0;
    let lastEarthquakeUpdate = 0;

    // Initialize the app
    async function init() {
      loadConversations();
      setupEventListeners();
      applyThemePreference();
      userLocation = await getUserLocation();
      
      // Create a new conversation if none exists
      if (conversations.length === 0) {
        createNewConversation();
      } else {
        // Load the most recent conversation
        loadConversation(conversations[0].id);
      }
      
      // Load weather and earthquake data
      updateWeatherAndEarthquakeData();
      
      // Set up periodic updates (every 1 minute)
      setInterval(updateWeatherAndEarthquakeData, 60000);
    }

    // Update weather and earthquake data if needed
    async function updateWeatherAndEarthquakeData() {
      const now = Date.now();
      
      // Update weather if more than 1 minute old
      if (now - lastWeatherUpdate > 60000) {
        await loadWeatherData();
        lastWeatherUpdate = now;
      }
      
      // Update earthquake data if more than 1 minute old
      if (now - lastEarthquakeUpdate > 60000) {
        await loadEarthquakeData();
        lastEarthquakeUpdate = now;
      }
    }

    // Load weather data
    async function loadWeatherData() {
      const weather = await getWeatherData(userLocation.city);
      
      const messagesContainer = document.getElementById('messages');
      
      // Clear existing weather alert if any
      const existingWeatherAlert = document.querySelector('.weather-alert');
      if (existingWeatherAlert) existingWeatherAlert.remove();
      
      // Add weather alert
      if (weather) {
        const weatherAlert = document.createElement('div');
        weatherAlert.className = 'weather-alert';
        
        const temp = weather.current_weather.temperature;
        const windspeed = weather.current_weather.windspeed;
        const weathercode = weather.current_weather.weathercode;
        
        // Simple weather code to text mapping
        const weatherDescriptions = {
          0: 'Clear sky',
          1: 'Mainly clear',
          2: 'Partly cloudy',
          3: 'Overcast',
          45: 'Fog',
          48: 'Depositing rime fog',
          51: 'Light drizzle',
          53: 'Moderate drizzle',
          55: 'Dense drizzle',
          56: 'Light freezing drizzle',
          57: 'Dense freezing drizzle',
          61: 'Slight rain',
          63: 'Moderate rain',
          65: 'Heavy rain',
          66: 'Light freezing rain',
          67: 'Heavy freezing rain',
          71: 'Slight snow fall',
          73: 'Moderate snow fall',
          75: 'Heavy snow fall',
          77: 'Snow grains',
          80: 'Slight rain showers',
          81: 'Moderate rain showers',
          82: 'Violent rain showers',
          85: 'Slight snow showers',
          86: 'Heavy snow showers',
          95: 'Thunderstorm',
          96: 'Thunderstorm with slight hail',
          99: 'Thunderstorm with heavy hail'
        };
        
        const weatherDesc = weatherDescriptions[weathercode] || 'Unknown weather';
        
        let alertHTML = `
          <div class="alert-title">
            <svg class="weather-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.477 2 2 6.477 2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2Z" fill="var(--primary-color)"/>
              <path d="M12 6V8M12 16V18M6.828 9.172L8.243 10.586M17.657 14.828L16.243 13.414M16 12H18M6 12H8M6.828 14.828L8.243 13.414M17.657 9.172L16.243 10.586" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Current Weather in ${weather.city}
          </div>
          <p>${weatherDesc}</p>
          <div class="weather-details">
            <div class="weather-detail">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2V4M12 20V22M4 12H2M6.31412 6.31412L4.8999 4.8999M17.6859 6.31412L19.1001 4.8999M6.31412 17.69L4.8999 19.1042M17.6859 17.69L19.1001 19.1042M22 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              ${temp}¬∞C
            </div>
            <div class="weather-detail">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2V4M12 20V22M4 12H2M6.31412 6.31412L4.8999 4.8999M17.6859 6.31412L19.1001 4.8999M6.31412 17.69L4.8999 19.1042M17.6859 17.69L19.1001 19.1042M22 12H20M18 12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              ${windspeed} km/h wind
            </div>
          </div>
          <div class="weather-map">
            <img src="https://cdn.fs.teachablecdn.com/xBFa8BAEQ6KiuJIaxKIv" alt="Weather map" style="width:100%;height:100%;object-fit:cover;">
          </div>
        `;
        
        weatherAlert.innerHTML = alertHTML;
        
        // Insert at the beginning of messages
        if (messagesContainer.firstChild) {
          messagesContainer.insertBefore(weatherAlert, messagesContainer.firstChild);
        } else {
          messagesContainer.appendChild(weatherAlert);
        }
      }
    }

    // Load earthquake data
    async function loadEarthquakeData() {
      const earthquakes = await getEarthquakeData();
      
      const messagesContainer = document.getElementById('messages');
      
      // Clear existing earthquake alert if any
      const existingEarthquakeAlert = document.querySelector('.earthquake-alert');
      if (existingEarthquakeAlert) existingEarthquakeAlert.remove();
      
      // Add earthquake alerts if any
      if (earthquakes.length > 0) {
        const earthquakeAlert = document.createElement('div');
        earthquakeAlert.className = 'earthquake-alert';
        
        let alertHTML = `
          <div class="alert-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.477 2 2 6.477 2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2Z" fill="#ff4d4f"/>
              <path d="M12 8V12M12 16H12.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Recent Earthquake Alerts
          </div>
          <div class="earthquake-details">
        `;
        
        earthquakes.forEach(quake => {
          const magnitude = quake.properties.mag;
          const place = quake.properties.place;
          const time = new Date(quake.properties.time).toLocaleString();
          
          alertHTML += `
            <div class="earthquake-item">
              <span class="earthquake-magnitude">M${magnitude}</span> - ${place} (${time})
            </div>
          `;
        });
        
        alertHTML += `</div>`;
        earthquakeAlert.innerHTML = alertHTML;
        
        // Insert at the beginning of messages
        if (messagesContainer.firstChild) {
          messagesContainer.insertBefore(earthquakeAlert, messagesContainer.firstChild);
        } else {
          messagesContainer.appendChild(earthquakeAlert);
        }
      }
    }

    // Set up event listeners
    function setupEventListeners() {
      document.getElementById('newChatBtn').addEventListener('click', createNewConversation);
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
      document.getElementById('mobileMenuBtn').addEventListener('click', toggleSidebar);
      
      // Mobile nav buttons
      document.getElementById('mobileSidebarToggle').addEventListener('click', toggleSidebar);
      document.getElementById('mobileNewChatBtn').addEventListener('click', createNewConversation);
      document.getElementById('mobileThemeToggle').addEventListener('click', toggleTheme);
    }

    // Create a new conversation
    function createNewConversation() {
      const newConversation = {
        id: Date.now().toString(),
        title: "New Chat",
        messages: [
          {
            sender: "bot",
            content: "Hello! I'm Neo . Tell me any topic name and I'll provide information with images and relevant videos when available.",
            timestamp: new Date().toISOString()
          }
        ],
        createdAt: new Date().toISOString()
      };
      
      conversations.unshift(newConversation);
      saveConversations();
      loadConversation(newConversation.id);
      
      // Load weather and earthquake data for new conversation
      updateWeatherAndEarthquakeData();
    }

    // Load a conversation by ID
    function loadConversation(conversationId) {
      currentConversationId = conversationId;
      const conversation = conversations.find(c => c.id === conversationId);
      
      if (!conversation) return;
      
      // Update chat title
      document.getElementById('chatTitle').textContent = conversation.title;
      
      // Clear and rebuild messages
      const messagesContainer = document.getElementById('messages');
      messagesContainer.innerHTML = '';
      
      // First add the initial bot message
      const initialMessage = conversation.messages.find(msg => 
        msg.sender === 'bot' && 
        msg.content.includes("Hello! I'm Neo")
      );
      
      if (initialMessage) {
        const msgDiv = document.createElement('div');
        msgDiv.className = initialMessage.sender;
        
        const msgContent = document.createElement('p');
        msgContent.textContent = initialMessage.content;
        
        msgDiv.appendChild(msgContent);
        messagesContainer.appendChild(msgDiv);
      }
      
      // Then process all other messages
      conversation.messages.forEach(msg => {
        if (msg === initialMessage) return;
        
        const msgDiv = document.createElement('div');
        msgDiv.className = msg.sender;
        
        // Check if this is a bot message with media content
        if (msg.sender === 'bot' && msg.mediaContent) {
          // Reconstruct the complete answer with media
          const textP = document.createElement('p');
          textP.textContent = msg.content;
          msgDiv.appendChild(textP);
          
          const mediaDiv = document.createElement('div');
          mediaDiv.innerHTML = msg.mediaContent;
          msgDiv.appendChild(mediaDiv);
        } else {
          // Regular text message
          const msgContent = document.createElement('p');
          msgContent.textContent = msg.content;
          msgDiv.appendChild(msgContent);
        }
        
        messagesContainer.appendChild(msgDiv);
      });
      
      // Load weather and earthquake data if this is the first conversation
      if (conversationId === conversations[0].id) {
        updateWeatherAndEarthquakeData();
      }
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Update active conversation in sidebar
      updateActiveConversation();
    }

    // Save conversations to local storage
    function saveConversations() {
      localStorage.setItem('conversations', JSON.stringify(conversations));
    }

    // Load conversations from local storage
    function loadConversations() {
      const conversationList = document.getElementById('conversationList');
      conversationList.innerHTML = '';
      
      conversations.forEach(conversation => {
        const conversationItem = document.createElement('div');
        conversationItem.className = 'conversation-item';
        conversationItem.textContent = conversation.title;
        conversationItem.dataset.id = conversation.id;
        
        conversationItem.addEventListener('click', () => {
          loadConversation(conversation.id);
        });
        
        conversationList.appendChild(conversationItem);
      });
      
      updateActiveConversation();
    }

    // Update active conversation in sidebar
    function updateActiveConversation() {
      const conversationItems = document.querySelectorAll('.conversation-item');
      conversationItems.forEach(item => {
        if (item.dataset.id === currentConversationId) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
    }

    // Update conversation title based on first user message
    function updateConversationTitle(messageContent) {
      const conversation = conversations.find(c => c.id === currentConversationId);
      if (!conversation || conversation.title !== "New Chat") return;
      
      // Use first 30 chars of the message as title
      const newTitle = messageContent.length > 30 
        ? messageContent.substring(0, 30) + '...' 
        : messageContent;
      
      conversation.title = newTitle;
      saveConversations();
      loadConversations();
      document.getElementById('chatTitle').textContent = newTitle;
    }

    // Toggle between dark and light theme
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      
      // Update theme toggle text
      document.getElementById('themeText').textContent = 
        newTheme === 'dark' ? 'Light Mode' : 'Dark Mode';
      document.getElementById('mobileThemeText').textContent = 
        newTheme === 'dark' ? 'Light' : 'Dark';
    }

    // Apply user's theme preference
    function applyThemePreference() {
      const savedTheme = localStorage.getItem('theme') || 
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      
      document.documentElement.setAttribute('data-theme', savedTheme);
      document.getElementById('themeText').textContent = 
        savedTheme === 'dark' ? 'Light Mode' : 'Dark Mode';
      document.getElementById('mobileThemeText').textContent = 
        savedTheme === 'dark' ? 'Light' : 'Dark';
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // Check for personal information questions
    function checkPersonalInfoQuestions(text) {
      const lowerCaseText = text.toLowerCase();
      
      // Define questions related to name, email, and password
      const nameQuestions = [
        "what's my name?", "what is my name?", "do you know my name?", "who am i?", "tell me my name",
        "What's my name?", "What is my name?", "Do you know my name?", "Who am i?", "Tell me my name",
        "my name is", "i am", "call me"
      ];
    
      const emailQuestions = [
        "what is my email?", "what is my email address?", "do you know my email?", "tell me my email", 
        "tell my email address", "What is my email?", "What is my email address?", "Do you know my email?", 
        "Tell me my email", "my email is", "email address is"
      ];
    
      const passwordQuestions = [
        "what is my password?", "what is my email password?", "please write my email password", 
        "plz tell me my email password", "plz write my email password", "please tell me my email password", 
        "What is my password?", "What is my email password?", "Please write my email password", 
        "Plz tell me my email password", "my password is", "password is"
      ];
    
      const ipQuestions = [
        "what is my ip?", "what's my ip address?", "do you know my ip?", "tell me my ip address",
        "What is my IP?", "What's my IP address?", "Do you know my IP?", "Tell me my IP address",
        "show my ip", "what is my internet address"
      ];
    
      // Check if the user is telling their name
      if (nameQuestions.some(q => lowerCaseText.includes(q)) || 
          lowerCaseText.startsWith("my name is") || 
          lowerCaseText.startsWith("i am") || 
          lowerCaseText.startsWith("call me")) {
        
        // Extract name from statement
        let name = text;
        if (lowerCaseText.startsWith("my name is")) {
          name = text.substring("my name is".length).trim();
        } else if (lowerCaseText.startsWith("i am")) {
          name = text.substring("i am".length).trim();
        } else if (lowerCaseText.startsWith("call me")) {
          name = text.substring("call me".length).trim();
        }
        
        // If it's a question about their name
        if (nameQuestions.some(q => lowerCaseText === q.toLowerCase())) {
          const userName = localStorage.getItem('userName') || 'Not Set';
          return { type: 'name', response: `Your name is ${userName}` };
        }
        
        // If they're telling their name
        localStorage.setItem('userName', name);
        return { type: 'name', response: `Okay, I'll remember your name is ${name}` };
      }
      
      // Check if the user is telling their email
      else if (emailQuestions.some(q => lowerCaseText.includes(q)) || 
             lowerCaseText.startsWith("my email is") || 
             lowerCaseText.includes("email address is")) {
        
        // Extract email from statement
        let email = text;
        if (lowerCaseText.startsWith("my email is")) {
          email = text.substring("my email is".length).trim();
        } else if (lowerCaseText.includes("email address is")) {
          const parts = text.split("email address is");
          email = parts[1].trim();
        }
        
        // If it's a question about their email
        if (emailQuestions.some(q => lowerCaseText === q.toLowerCase())) {
          const userEmail = localStorage.getItem('userEmail') || 'Not Set';
          return { type: 'email', response: `Your email is ${userEmail}` };
        }
        
        // If they're telling their email
        localStorage.setItem('userEmail', email);
        return { type: 'email', response: `I've stored your email address as ${email}` };
      }
      
      // Check if the user is telling their password
      else if (passwordQuestions.some(q => lowerCaseText.includes(q)) || 
             lowerCaseText.startsWith("my password is")) {
        
        // Extract password from statement
        let password = text;
        if (lowerCaseText.startsWith("my password is")) {
          password = text.substring("my password is".length).trim();
        }
        
        // If it's a question about their password
        if (passwordQuestions.some(q => lowerCaseText === q.toLowerCase())) {
          const userPassword = localStorage.getItem('userPassword') || 'Not Set';
          return { type: 'password', response: `Your password is ${userPassword}` };
        }
        
        // If they're telling their password
        localStorage.setItem('userPassword', password);
        return { type: 'password', response: `I've stored your password` };
      }
      
      // Check if the user is asking about their IP
      else if (ipQuestions.some(q => lowerCaseText.includes(q))) {
        return { type: 'ip', response: `Your IP address is ${userLocation.ip}` };
      }
      
      return null;
    }

    // Send message function
    async function sendMessage() {
      const userInput = document.getElementById('userInput');
      const query = userInput.value.trim();
      if (!query) return;

      // Add user message to UI
      addMessage(query, 'user');
      
      // Update conversation title if this is the first user message
      const conversation = conversations.find(c => c.id === currentConversationId);
      if (conversation && conversation.title === "New Chat") {
        updateConversationTitle(query);
      }
      
      // Add user message to conversation
      addMessageToConversation(query, 'user');
      
      userInput.value = '';
      
      // Show typing indicator
      showTypingIndicator();
      
      // First check for personal info questions
      const personalInfoResponse = checkPersonalInfoQuestions(query);
      if (personalInfoResponse) {
        addMessage(personalInfoResponse.response, 'bot');
        addMessageToConversation(personalInfoResponse.response, 'bot');
        hideTypingIndicator();
        return;
      }
      
      // Otherwise get answer from APIs
      await getAnswer(query);
      
      // Hide typing indicator
      hideTypingIndicator();
    }

    // Add message to UI
    function addMessage(text, sender = 'bot', media = '') {
      const msgContainer = document.createElement('div');
      msgContainer.className = sender;

      const msg = document.createElement('p');
      msg.textContent = text;

      msgContainer.appendChild(msg);

      if (media) {
        const wrapper = document.createElement('div');
        wrapper.className = 'media';
        wrapper.innerHTML = media;
        msgContainer.appendChild(wrapper);
      }

      document.getElementById('messages').appendChild(msgContainer);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    }

    // Add message to current conversation
    function addMessageToConversation(content, sender, mediaContent = '') {
      const conversation = conversations.find(c => c.id === currentConversationId);
      if (!conversation) return;
      
      const message = {
        sender,
        content,
        timestamp: new Date().toISOString()
      };
      
      // Store media content if provided
      if (mediaContent) {
        message.mediaContent = mediaContent;
      }
      
      conversation.messages.push(message);
      saveConversations();
    }

    // Show typing indicator
    function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.className = 'bot typing-indicator';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      document.getElementById('messages').appendChild(typingDiv);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    }

    // Hide typing indicator
    function hideTypingIndicator() {
      const typingIndicator = document.getElementById('typingIndicator');
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }

    // Get answer from APIs
    async function getAnswer(query) {
      let hasWikipediaContent = false;
      let wikipediaText = "";
      let wikipediaImage = "";
      let otherImages = [];
      let video = "";
      let videoInfo = null;
    
      // Try to get Wikipedia content first
      try {
        const wikiRes = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
        const wikiData = await wikiRes.json();
        if (wikiData.extract) {
          wikipediaText = wikiData.extract;
          if (wikiData.thumbnail?.source) {
            wikipediaImage = wikiData.thumbnail.source;
          }
          hasWikipediaContent = true;
        }
      } catch (error) {
        console.error("Wikipedia API error:", error);
      }
    
      // Get additional images from DuckDuckGo
      try {
        const ddgRes = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_redirect=1`);
        const ddgData = await ddgRes.json();
        if (ddgData.RelatedTopics) {
          otherImages = ddgData.RelatedTopics
            .filter(topic => topic.Icon?.URL)
            .map(topic => topic.Icon.URL)
            .slice(0, 3);
        }
      } catch (error) {
        console.error("DuckDuckGo API error:", error);
      }
    
      // Get YouTube videos - now sorted by relevance
      try {
        const videos = await searchYouTubeVideos(query);
        if (videos.length > 0) {
          // Get the most relevant video
          const bestVideo = videos[0];
          const duration = formatDuration(bestVideo.duration);
          
          // Create download link
          const downloadLink = `https://en1.savefrom.net/#url=${encodeURIComponent(bestVideo.url)}`;
          
          video = `
            <div class="video-container">
              <iframe src="https://www.youtube.com/embed/${bestVideo.id}?enablejsapi=1" 
                      frameborder="0" 
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                      allowfullscreen></iframe>
              <div class="video-info">
                <span title="Views">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 5C7 5 2.73 8.11 1 12.5C2.73 16.89 7 20 12 20C17 20 21.27 16.89 23 12.5C21.27 8.11 17 5 12 5ZM12 17.5C9.24 17.5 7 15.26 7 12.5C7 9.74 9.24 7.5 12 7.5C14.76 7.5 17 9.74 17 12.5C17 15.26 14.76 17.5 12 17.5ZM12 9.5C10.34 9.5 9 10.84 9 12.5C9 14.16 10.34 15.5 12 15.5C13.66 15.5 15 14.16 15 12.5C15 10.84 13.66 9.5 12 9.5Z" fill="currentColor"/>
                  </svg>
                  ${bestVideo.views}
                </span>
                <span title="Likes">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="currentColor"/>
                  </svg>
                  ${bestVideo.likes}
                </span>
                <span title="Duration">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" fill="currentColor"/>
                    <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z" fill="currentColor"/>
                  </svg>
                  ${duration}
                </span>
                <span title="Channel">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.51-3.49L17.5 6.5 9.99 9.99 6.5 17.5zm5.5-6.6c.61 0 1.1.49 1.1 1.1s-.49 1.1-1.1 1.1-1.1-.49-1.1-1.1.49-1.1 1.1-1.1z" fill="currentColor"/>
                  </svg>
                  ${bestVideo.channel}
                </span>
                <a href="${downloadLink}" target="_blank" class="download-btn" title="Download">
                  <span>Download</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" fill="currentColor"/>
                  </svg>
                </a>
              </div>
            </div>
          `;
          
          videoInfo = {
            title: bestVideo.title,
            channel: bestVideo.channel
          };
        }
      } catch (error) {
        console.error("YouTube search error:", error);
        // Continue with Wikipedia and images even if YouTube fails
      }
    
      // Create message container
      const msgContainer = document.createElement('div');
      msgContainer.className = 'bot';
    
      // Create main message paragraph
      const msgParagraph = document.createElement('p');
      msgParagraph.textContent = `Here's what I found about "${query}":`;
      msgContainer.appendChild(msgParagraph);
    
      // Create content sections container
      const contentSections = document.createElement('div');
      contentSections.className = 'content-section';
    
      // Add images first (Wikipedia image + other images)
      const allImages = [];
      if (wikipediaImage) allImages.push(wikipediaImage);
      allImages.push(...otherImages);
      
      if (allImages.length > 0) {
        const mediaSection = document.createElement('div');
        mediaSection.className = 'media-section';
        
        const imageContainer = document.createElement('div');
        imageContainer.className = 'image-container';
        
        allImages.forEach(imgSrc => {
          const imgElement = document.createElement('img');
          imgElement.src = imgSrc;
          imgElement.alt = query;
          imageContainer.appendChild(imgElement);
        });
        
        mediaSection.appendChild(imageContainer);
        contentSections.appendChild(mediaSection);
      }
    
      // Add Wikipedia content if available
      if (hasWikipediaContent) {
        const wikiSection = document.createElement('div');
        wikiSection.className = 'wikipedia-container';
        
        const wikiTitle = document.createElement('div');
        wikiTitle.className = 'wikipedia-title';
        wikiTitle.innerHTML = `
          <svg class="wikipedia-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.477 2 2 6.477 2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2Z" fill="currentColor"/>
            <path d="M12 6C8.686 6 6 8.686 6 12C6 15.314 8.686 18 12 18C15.314 18 18 15.314 18 12C18 8.686 15.314 6 12 6Z" fill="white"/>
            <path d="M12 10C10.895 10 10 10.895 10 12C10 13.105 10.895 14 12 14C13.105 14 14 13.105 14 12C14 10.895 13.105 10 12 10Z" fill="currentColor"/>
          </svg>
          ${wikipediaText.includes("NeoDot") ? "NeoDot Summary" : "Wikipedia Summary"}
        `;
        
        const wikiText = document.createElement('div');
        wikiText.className = 'wikipedia-text';
        wikiText.textContent = wikipediaText.replace("NeoDot in Wikipedia Summary:\n", "");
        
        wikiSection.appendChild(wikiTitle);
        wikiSection.appendChild(wikiText);
        contentSections.appendChild(wikiSection);
      }
    
      // Add video if available
      if (video) {
        const videoSection = document.createElement('div');
        videoSection.className = 'video-container';
        videoSection.innerHTML = video;
        contentSections.appendChild(videoSection);
      }
    
      // If no content was found at all
      if (!hasWikipediaContent && allImages.length === 0 && !video) {
        const noResultsMsg = document.createElement('p');
        noResultsMsg.textContent = "I couldn't find any information about that. Try asking something else.";
        msgContainer.appendChild(noResultsMsg);
      } else {
        msgContainer.appendChild(contentSections);
      }
    
      // Add the message to the chat
      document.getElementById('messages').appendChild(msgContainer);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
      
      // Store the complete answer (with media) in conversation
      addMessageToConversation(
        `Here's what I found about "${query}":`,
        'bot',
        contentSections.outerHTML
      );
      
      // Check video visibility after adding
      setTimeout(handleVideoVisibility, 100);
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter') sendMessage();
    }

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
</script>
<script>
  const toggleBtn = document.getElementById('langToggleBtn');
  const translateEl = document.getElementById('google_translate_element');
  let googleLoaded = false;

  toggleBtn.addEventListener('click', () => {
    if (!googleLoaded) {
      const script = document.createElement('script');
      script.src = "https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
      document.body.appendChild(script);
      googleLoaded = true;
    }
    translateEl.style.display = translateEl.style.display === 'none' || !translateEl.style.display
      ? 'block'
      : 'none';
  });

  window.googleTranslateElementInit = () => {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,es,fr,de,it,ja,zh,ru,pt,ar,hi,bn,ko,vi,th,tr,nl,pl,sv,fi,el,cs,hu', // Updated with 3 more languages
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
      autoDisplay: false
    }, 'google_translate_element');
  };
</script>
</body>
</html>
