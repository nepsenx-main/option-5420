<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login/Sign Up</title>
    <script src="E:\NepsenX\NepsenX codes\home\tw.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="E:\NepsenX\NepsenX codes\CG\src\three.min.js"></script>
    <style>
:root {
    /* Light theme colors */
    --bg-primary: #ffffff;
    --bg-secondary: #e3f2fd;
    --text-primary: #1976d2;
    --text-secondary: #424242;
    --border-color: rgba(33, 150, 243, 0.1);
    --card-bg: rgba(255, 255, 255, 0.95);
    --card-bg-secondary: rgba(227, 242, 253, 0.9);
    --input-bg: rgba(255, 255, 255, 0.9);
    --input-bg-secondary: rgba(227, 242, 253, 0.8);
    --shadow-color: rgba(33, 150, 243, 0.15);
    --shadow-color-secondary: rgba(33, 150, 243, 0.1);
    --button-bg: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    --toggle-bg: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.95) 0%, 
        rgba(227, 242, 253, 0.95) 100%);
    --toggle-thumb-bg: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    --form-label-color: #1976d2;
    --data-label-color: #1976d2;
    --data-value-color: #424242;
    --border-radius: 16px;
    --background-image: url('/opena/back-04h2GsxM.gif');
}

[data-theme="dark"] {
    /* Dark theme colors */
    --bg-primary: #0a0a0a;
    --bg-secondary: #1a1a1a;
    --text-primary: #6b6b6b;
    --text-secondary: #88b8b8;
    --border-color: rgba(192, 192, 192, 0.05);
    --card-bg: rgba(20, 20, 20, 0.9);
    --card-bg-secondary: rgba(10, 10, 10, 0.8);
    --input-bg: rgba(20, 20, 20, 0.9);
    --input-bg-secondary: rgba(10, 10, 10, 0.8);
    --shadow-color: rgba(0, 0, 0, 0.5);
    --shadow-color-secondary: rgba(0, 0, 0, 0.3);
    --button-bg: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    --toggle-bg: linear-gradient(135deg, 
        rgba(20, 20, 20, 0.95) 0%, 
        rgba(10, 10, 10, 0.95) 100%);
    --toggle-thumb-bg: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    --form-label-color: #8b8b8b;
    --data-label-color: #6b6b6b;
    --data-value-color: #88b8b8;
    --background-image: url('/opena/make it run able and-20250915 (online-video-cutter.com).gif');
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

  body {
        overflow-x: hidden;
        overflow-y: transparent; 
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    position: relative;
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-primary) 100%);
    background-image: var(--background-image);
    background-size: cover;
    background-position: fixed;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.background-media {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.03;
    object-fit: cover;
    filter: blur(5px) contrast(1.2);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.container {
    width: 100%;
    max-width: 500px;  /* 修改最大宽度为500px */
    padding: 20px;
    z-index: 1;
    margin: 0 auto;    /* 添加这行使其水平居中 */
    animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    animation-fill-mode: both;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.card {
    background: linear-gradient(135deg, var(--card-bg) 0%, var(--card-bg-secondary) 100%);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-radius: var(--border-radius);
    padding: 40px;
    box-shadow: 
        0 8px 32px var(--shadow-color),
        0 2px 16px var(--shadow-color-secondary),
        inset 0 0 0 1px rgba(255, 255, 255, 0.5);
    transform-style: preserve-3d;
    perspective: 1000px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    border: 1px solid var(--border-color);
    margin: 0 auto;    /* 添加这行使其水平居中 */
    max-width: 500px;  /* 添加最大宽度限制 */
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
        rgba(33, 150, 243, 0.05) 0%, 
        rgba(33, 150, 243, 0.02) 50%, 
        rgba(33, 150, 243, 0) 100%);
    pointer-events: none;
    border-radius: inherit;
}

[data-theme="dark"] .card {
    box-shadow: 
        0 8px 32px var(--shadow-color),
        0 2px 16px var(--shadow-color-secondary),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.card-header {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
    z-index: 1;
}

.card-header h1 {
    background: linear-gradient(135deg, #1976d2 0%, #42a5f5 50%, #1976d2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
    font-size: 32px;
    letter-spacing: -0.5px;
    text-transform: uppercase;
    margin-bottom: 8px;
    transform: translateZ(30px);
    animation: glow 3s ease-in-out infinite alternate;
}

@keyframes glow {
    from {
        filter: drop-shadow(0 0 5px rgba(33, 150, 243, 0.3));
    }
    to {
        filter: drop-shadow(0 0 20px rgba(33, 150, 243, 0.5));
    }
}

.card-header p {
    color: var(--text-primary);
    font-size: 16px;
    font-weight: 400;
    opacity: 0.8;
}

.form-group {
    margin-bottom: 24px;
    position: relative;
    animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    animation-fill-mode: both;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(15px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.form-group:nth-child(1) { animation-delay: 0.1s; }
.form-group:nth-child(2) { animation-delay: 0.2s; }
.form-group:nth-child(3) { animation-delay: 0.3s; }
.form-group:nth-child(4) { animation-delay: 0.4s; }
.form-group:nth-child(5) { animation-delay: 0.5s; }

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--form-label-color);
    font-size: 14px;
    transition: all 0.3s ease;
}

.form-control {
    width: 100%;
    padding: 16px 20px;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 16px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, var(--input-bg) 0%, var(--input-bg-secondary) 100%);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
}

.form-control::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(33, 150, 243, 0.1), 
        transparent);
    transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.form-control:focus::before {
    left: 100%;
}

.form-control:focus {
    border-color: #1976d2;
    box-shadow: 
        0 0 0 3px rgba(33, 150, 243, 0.1),
        0 0 0 1px rgba(33, 150, 243, 0.2);
    outline: none;
    transform: translateY(-2px);
}

.btn {
    width: 100%;
    padding: 16px 24px;
    border: none;
    border-radius: var(--border-radius);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
    z-index: 1;
    background: var(--button-bg);
    color: #ffffff;
    box-shadow: 
        0 4px 15px var(--shadow-color),
        0 1px 8px var(--shadow-color-secondary);
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.1) 0%, 
        rgba(255, 255, 255, 0) 100%);
    transform: translateX(-100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.btn:hover::before {
    transform: translateX(0);
}
  
.btn:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px var(--shadow-color),
        0 2px 10px var(--shadow-color-secondary);
}

.btn-secondary {
    background: transparent;
    color: var(--text-primary);
    margin-top: 12px;
    position: relative;
    box-shadow: none;
    display: inline-block;
    width: 100%;
    padding: 12px 24px;
    margin: 0 10px;
}

.btn-secondary::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #1976d2 0%, #42a5f5 100%);
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.btn-secondary:hover::after {
    width: 100%;
}

[data-theme="dark"] .btn-secondary:hover {
    background: rgba(192, 192, 192, 0.05);
}

.forgot-password {
    text-align: center;
    margin-top: 24px;
}

.forgot-password a {
    color: var(--text-primary);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
}

.forgot-password a::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #1976d2 0%, #42a5f5 100%);
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.forgot-password a:hover {
    color: var(--forget-password);
    text-decoration: underline;
}

.forgot-password a:hover::after {
    width: 100%;
}

.theme-toggle {
    position: absolute;
    top: 24px;
    right: 24px;
    background: var(--toggle-bg);
    width: 64px;
    height: 32px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    padding: 0 6px;
    cursor: pointer;
    box-shadow: 
        0 2px 8px var(--shadow-color),
        0 1px 3px var(--shadow-color-secondary);
    z-index: 100;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--border-color);
}

.toggle-thumb {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--toggle-thumb-bg);
    position: absolute;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px var(--shadow-color);
}

[data-theme="light"] .toggle-thumb {
    left: 5px;
}

[data-theme="dark"] .toggle-thumb {
    left: 33px;
}

.scene {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
}

.otp-container {
    display: flex;
    justify-content: space-between;
    margin: 20px 0;
}

.otp-input {
    width: 50px;
    height: 50px;
    text-align: center;
    font-size: 24px;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    background: linear-gradient(135deg, var(--input-bg) 0%, var(--input-bg-secondary) 100%);
    transition: all 0.3s ease;
}

.otp-input:focus {
    border-color: var(--otp-input);
    box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
    transform: translateY(-2px);
}

.user-data {
    max-height: 300px;
    overflow-y: auto;
    margin-top: 20px;
    padding: 15px;
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.1) 0%, 
        rgba(227, 242, 253, 0.15) 100%);
    border-radius: 12px;
    backdrop-filter: blur(10px);
}

[data-theme="dark"] .user-data {
    background: linear-gradient(135deg, 
        rgba(20, 20, 20, 0.15) 0%, 
        rgba(10, 10, 10, 0.2) 100%);
}

.data-item {
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.data-item:hover {
    transform: translateX(5px);
}

.data-label {
    font-weight: 600;
    color: var(--data-label-color);
    font-size: 14px;
}

.data-value {
    color: var(--data-value-color);
    font-size: 16px;
    margin-top: 4px;
}

.signup-options {
    display: flex;
    gap: 10px;
}

.signup-options select {
    flex: 1;
    padding: 12px;
    border-radius: var(--border-radius);
    border: 2px solid var(--border-color);
    background: linear-gradient(135deg, var(--input-bg) 0%, var(--input-bg-secondary) 100%);
    cursor: pointer;
    transition: all 0.3s ease;
}

.signup-options select:hover {
    border-color: var(--signup-options-select);
}

.hidden {
    display: none;
}

@media (max-width: 500px) {
    .container {
        padding: 15px;
    }
    
    .card {
        padding: 20px;
    }
    
    .otp-input {
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
}

/* 添加新的动画效果 */
@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
}

   /* 添加新的交互效果 */
   .card:hover {
       transform: translateY(-5px);
       box-shadow: 
           0 12px 40px var(--shadow-color),
           0 4px 20px var(--shadow-color-secondary);
  }
   
   [data-theme="dark"] .card:hover {
       box-shadow: 
           0 12px 40px var(--shadow-color),
           0 4px 20px var(--shadow-color-secondary);
   }
   
   /* 添加金属质感效果 */
   .metal-effect {
       background: linear-gradient(135deg, 
           rgba(33, 150, 243, 0.1) 0%, 
           rgba(33, 150, 243, 0.05) 50%, 
           rgba(33, 150, 243, 0.1) 100%);
       background-size: 200% 200%;
       animation: metalShine 3s ease-in-out infinite;
   }
   
   @keyframes metalShine {
       0% { background-position: 0% 50%; }
       50% { background-position: 100% 50%; }
       100% { background-position: 0% 50%; }
   }
   
   /* 添加光晕效果 */
   .glow-effect {
       position: absolute;
       top: -50%;
       left: -50%;
       width: 200%;
       height: 200%;
       background: radial-gradient(circle, 
           rgba(33, 150, 243, 0.15) 0%, 
           transparent 70%);
       animation: rotate 20s linear infinite;
   }
   @keyframes rotate {
       from { transform: rotate(0deg); }
       to { transform: rotate(360deg); }
   }
    </style>
</head>
<body data-theme="light">
    <!-- Background Video for Light Theme -->
    <video id="lightBackground" src="E:\OneDrive\NepsenX all codes\opena\back-04h2GsxM.webm" class="background-media" autoplay loop muted playsinline></video>
    
    <!-- Background GIF for Dark Theme -->
    <img id="darkBackground" src="E:\OneDrive\NepsenX all codes\opena\make it run able and-20250915 (online-video-cutter.com).gif" class="background-media hidden" alt="Abstract moving shapes background">
    
    <!-- 3D Background Scene -->
    <div class="scene" id="scene"></div>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle">
        <div class="toggle-thumb"></div>
    </div>

    <!-- Message Box (replaces alert/confirm) -->
    <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center transform transition-all scale-95 duration-300">
            <p id="messageText" class="text-gray-800 text-lg font-semibold mb-4"></p>
            <button id="messageOkBtn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-full hover:bg-blue-700 transition-colors">OK</button>
        </div>
    </div>
    
    <div class="container">
        <!-- Login Form -->
        <div class="card" id="loginCard">
            <div class="card-header">
                <div class="flex items-center justify-center mb-2">
                    <div class="w-16 h-16 rounded-full overflow-hidden mr-3 animate-float">
                        <img src="E:\NepsenX\NepsenX codes\CG\src\th-removebg-preview__3_-removebg-preview (1).png" alt="NepsenX logo "></img>
                    </div>
                </div>
                <h1 class="text-3xl font-bold text-center bg-gradient-to-r from-blue-500 to-blue-600 bg-clip-text text-transparent inline-block">
                    NepsenX
                </h1>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" class="form-control" id="email" placeholder="Enter your email" style="color: var(--text-secondary);" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter your password" style="color: var(--text-secondary);" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
                <button type="button" class="btn btn-secondary" id="showSignup">Create Account</button>
                <div class="forgot-password" style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                    <div style="flex: 1;"></div>
                    <a href="#" id="showForgotPassword" style="font-size: 14px; margin: 0;">Forgot your password?</a>
                </div>
            </form>
        </div>
        
        <!-- Signup Form - Step 1: Basic Info -->
        <div class="card hidden" id="signupCard">
            <div class="card-header">
                <h1>Create Account</h1>
                <p>Join us to get started</p>
            </div>
            <form id="signupFormStep1">
                <div class="form-group">
                    <label for="signupName">First Name</label>
                    <input type="text" class="form-control" id="signupName" placeholder="Enter your first name" style="color: var(--text-secondary);" required>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" class="form-control" id="signupEmail" placeholder="Enter your email" style="color: var(--text-secondary);" required>
                </div>
                <div class="form-group signup-options">
                    <div>
                        <label for="signupGender">Gender</label>
                        <select class="form-control" id="signupGender" style="color: var(--text-secondary);" required>
                            <option value="">Select</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="signupDob">Date of Birth</label>
                        <input type="date" class="form-control" id="signupDob" style="color: var(--text-secondary);" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Next</button>
                <button type="button" class="btn btn-secondary" id="showLogin">Back to Login</button>
            </form>
        </div>
        
        <!-- OTP Verification -->
        <div class="card hidden" id="otpCard">
            <div class="card-header">
                <h1>Verify Your Identity</h1>
                <p>Enter the OTP sent to your email</p>
            </div>
            <div class="otp-container">
                <input type="text" class="otp-input" maxlength="1" id="otp1" style="color: var(--text-secondary);" >
                <input type="text" class="otp-input" maxlength="1" id="otp2" style="color: var(--text-secondary);" >
                <input type="text" class="otp-input" maxlength="1" id="otp3" style="color: var(--text-secondary);" >
                <input type="text" class="otp-input" maxlength="1" id="otp4" style="color: var(--text-secondary);" > 
                <input type="text" class="otp-input" maxlength="1" id="otp5" style="color: var(--text-secondary);" >
                <input type="text" class="otp-input" maxlength="1" id="otp6" style="color: var(--text-secondary);" >
            </div>
            <button class="btn btn-primary" id="verifyOtp">Verify</button>
            <button class="btn btn-secondary" id="resendOtp">Resend OTP</button>
        </div>
        
        <!-- Signup Form - Step 2: Password -->
        <div class="card hidden" id="passwordCard">
            <div class="card-header">
                <h1>Create Password</h1>
                <p>Create a secure password for your account</p>
            </div>
            <form id="signupFormStep2">
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" class="form-control" id="signupPassword" placeholder="Create a strong password" style="color: var(--text-secondary);" required>
                </div>
                <div class="form-group">
                    <label for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" class="form-control" id="signupConfirmPassword" placeholder="Confirm your password" style="color: var(--text-secondary);" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign Up</button>
                <button type="button" class="btn btn-secondary" id="backToOtp">Back</button>
            </form>
        </div>
        
        <!-- Forgot Password -->
        <div class="card hidden" id="forgotPasswordCard">
            <div class="card-header">
                <h1>Reset Password</h1>
                <p>Enter your email to reset your password</p>
            </div>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="resetEmail">Email Address</label>
                    <input type="email" class="form-control" id="resetEmail" placeholder="Enter your email" style="color: var(--text-secondary);" required>
                </div>
                <button type="submit" class="btn btn-primary">Reset Password</button>
                <button type="button" class="btn btn-secondary" id="backToLogin">Back to Login</button>
            </form>
        </div>
        
        <!-- User Data Display -->
        <div class="card hidden" id="userDataCard">
            <div class="card-header">
                <h1>User Profile</h1>
                <p>Your account information</p>
            </div>
            <div class="user-data" id="userData">
                <!-- User data will be displayed here -->
            </div>
            <button class="btn btn-primary" id="logoutButton" style="margin-top: 20px;">Logout</button>
        </div>
    </div>

    <script>
        // Message Box Function (replaces alert/confirm)
        function showMessageBox(message, onOk = () => {}) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const messageOkBtn = document.getElementById('messageOkBtn');
            
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('flex');

            const handleOk = () => {
                messageBox.classList.add('hidden');
                messageBox.classList.remove('flex');
                messageOkBtn.removeEventListener('click', handleOk);
                onOk();
            };
            
            messageOkBtn.addEventListener('click', handleOk);
        }

        // Configuration
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx7As1xSZB_yyRCdl9bZlua19XBt4VWCHD-QZ7vb_JuosDWKffAglpdTy3VFyVamAsb/exec'; // Replace with your Google Apps Script URL
        
        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const lightBackground = document.getElementById('lightBackground');
        const darkBackground = document.getElementById('darkBackground');
        
        const loginCard = document.getElementById('loginCard');
        const signupCard = document.getElementById('signupCard');
        const otpCard = document.getElementById('otpCard');
        const passwordCard = document.getElementById('passwordCard');
        const forgotPasswordCard = document.getElementById('forgotPasswordCard');
        const userDataCard = document.getElementById('userDataCard');
        
        const showSignupBtn = document.getElementById('showSignup');
        const showLoginBtn = document.getElementById('showLogin');
        const showForgotPasswordBtn = document.getElementById('showForgotPassword');
        const backToLoginBtn = document.getElementById('backToLogin');
        const backToOtpBtn = document.getElementById('backToOtp');
        
        const loginForm = document.getElementById('loginForm');
        const signupFormStep1 = document.getElementById('signupFormStep1');
        const signupFormStep2 = document.getElementById('signupFormStep2');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        
        const verifyOtpBtn = document.getElementById('verifyOtp');
        const resendOtpBtn = document.getElementById('resendOtp');
        const logoutButton = document.getElementById('logoutButton');
        
        // Store user data between steps
        let userData = {};
        
        // Google Apps Script API Functions
        async function callAppScript(endpoint, data) {
            try {
                const response = await fetch(`${SCRIPT_URL}?endpoint=${endpoint}`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }
        
        // Theme Toggle
        themeToggle.addEventListener('click', () => {
            if (body.getAttribute('data-theme') === 'light') {
                body.setAttribute('data-theme', 'dark');
                lightBackground.classList.add('hidden');
                darkBackground.classList.remove('hidden');
            } else {
                body.setAttribute('data-theme', 'light');
                darkBackground.classList.add('hidden');
                lightBackground.classList.remove('hidden');
            }
        });
        
        // Show/Hide Cards
        showSignupBtn.addEventListener('click', () => {
            loginCard.classList.add('hidden');
            signupCard.classList.remove('hidden');
        });
        
        showLoginBtn.addEventListener('click', () => {
            signupCard.classList.add('hidden');
            forgotPasswordCard.classList.add('hidden');
            loginCard.classList.remove('hidden');
        });
        
        showForgotPasswordBtn.addEventListener('click', () => {
            loginCard.classList.add('hidden');
            forgotPasswordCard.classList.remove('hidden');
        });
        
        backToLoginBtn.addEventListener('click', () => {
            forgotPasswordCard.classList.add('hidden');
            loginCard.classList.remove('hidden');
        });
        
        backToOtpBtn.addEventListener('click', () => {
            passwordCard.classList.add('hidden');
            otpCard.classList.remove('hidden');
        });
        
        // Form Submissions
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                // Simulate login process
                await simulateLogin(email, password);
            } catch (error) {
                showMessageBox('Login failed, please try again');
            }
        });
        
        // Step 1: Basic info submission
        signupFormStep1.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect user data
            userData = {
                name: document.getElementById('signupName').value,
                email: document.getElementById('signupEmail').value,
                gender: document.getElementById('signupGender').value,
                dob: document.getElementById('signupDob').value
            };
            
            try {
                // Check if email already exists
                const response = await callAppScript('checkEmail', {
                    email: userData.email
                });
                
                if (response.emailExists) {
                    showMessageBox('This email is already registered');
                    return;
                }
                
                // Generate and send OTP
                await generateAndSendOtp(userData.email);
                signupCard.classList.add('hidden');
                otpCard.classList.remove('hidden');
            } catch (error) {
                showMessageBox('Registration failed, please try again');
            }
        });
        
        // Step 2: Password submission
        signupFormStep2.addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showMessageBox('Passwords do not match!');
                return;
            }
            
            // Add password to user data
            userData.password = password;
            
            try {
                // Complete registration
                await completeRegistration(userData);
            } catch (error) {
                showMessageBox('Registration failed, please try again');
            }
        });
        
        forgotPasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value;
            
            try {
                // Simulate password reset process
                await simulatePasswordReset(email);
            } catch (error) {
                showMessageBox('Password reset failed, please try again');
            }
        });
        
        // OTP Verification
        verifyOtpBtn.addEventListener('click', async () => {
            const otp = document.getElementById('otp1').value +
                       document.getElementById('otp2').value +
                       document.getElementById('otp3').value +
                       document.getElementById('otp4').value +
                       document.getElementById('otp5').value +
                       document.getElementById('otp6').value;
            
            try {
                const response = await callAppScript('verifyOtp', {
                    email: userData.email,
                    otp: otp
                });
                
                if (response.success) {
                    // OTP verified successfully
                    otpCard.classList.add('hidden');
                    passwordCard.classList.remove('hidden');
                } else {
                    showMessageBox('Invalid OTP, please try again');
                }
            } catch (error) {
                showMessageBox('Verification failed, please try again');
            }
        });
        
        resendOtpBtn.addEventListener('click', async () => {
            try {
                await callAppScript('resendOtp', {
                    email: userData.email
                });
                showMessageBox('New OTP has been sent to your email');
            } catch (error) {
                showMessageBox('Failed to send OTP, please try again');
            }
        });
        
        // Logout
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('userData');
            localStorage.removeItem('otp');
            localStorage.removeItem('userEmail');
            userDataCard.classList.add('hidden');
            loginCard.classList.remove('hidden');
        });
        
        // Auto OTP tabbing
        const otpInputs = document.querySelectorAll('.otp-input');
        otpInputs.forEach((input, index) => {
            input.addEventListener('input', () => {
                if (input.value.length === 1 && index < otpInputs.length - 1) {
                    otpInputs[index + 1].focus();
                }
            });
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && input.value === '' && index > 0) {
                    otpInputs[index - 1].focus();
                }
            });
        });
        
        // Complete registration process
        async function completeRegistration(userData) {
            try {
                // Get user IP from device
                const ip = await getIP();
                
                const response = await callAppScript('signup', {
                    name: userData.name,
                    email: userData.email,
                    gender: userData.gender,
                    dob: userData.dob,
                    password: userData.password,
                    ip: ip,
                    operatingSystem: navigator.platform,
                    location: 'Simulated Location'
                });
                
                if (response.success) {
                    passwordCard.classList.add('hidden');
                    userDataCard.classList.remove('hidden');
                    displayUserData(userData);
                } else {
                    showMessageBox('Registration failed, please try again');
                }
            } catch (error) {
                throw error;
            }
        }
        
        // Simulated Functions
        async function simulateLogin(email, password) {
            try {
                const response = await callAppScript('login', {
                    email: email,
                    password: password
                });
                
                if (response.success) {
                    // Generate and send OTP
                    await generateAndSendOtp(email);
                    loginCard.classList.add('hidden');
                    otpCard.classList.remove('hidden');
                } else {
                    if (response.userExists) {
                        // Simulate sending security email
                        showMessageBox('Incorrect password, security alert sent to your email');
                    } else {
                        showMessageBox('Account not found');
                    }
                }
            } catch (error) {
                throw error;
            }
        }
        
        async function simulatePasswordReset(email) {
            try {
                const response = await callAppScript('resetPassword', {
                    email: email
                });
                
                if (response.success) {
                    // Generate and send OTP
                    await generateAndSendOtp(email);
                    forgotPasswordCard.classList.add('hidden');
                    otpCard.classList.remove('hidden');
                } else {
                    showMessageBox('Account not found');
                }
            } catch (error) {
                throw error;
            }
        }
        
        async function generateAndSendOtp(email) {
            try {
                // Generate random 6-digit OTP
                const otp = Math.floor(100000 + Math.random() * 900000).toString();

                const mailhtml = `
`;
                // Save OTP and email to localStorage


                // Save OTP and email to localStorage
                localStorage.setItem('otp', otp);
                localStorage.setItem('userEmail', email);
                
                // Send OTP to user email using Formmit API
                const response = await fetch('https://api.formmit.com/v1/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        'to': email,
                        'subject': 'Your OTP Verification Code',
                        'html': mailhtml,
                        'from': 'noreply@NepsenX.com',
                        'reply_to': 'noreply@NepsenX.com'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to send OTP: ${response.statusText}`);
                }
                
                // For demo purposes, also log the OTP
                console.log(`OTP for ${email}: ${otp}`);
                showMessageBox(`OTP has been sent to ${email}`);
            } catch (error) {
                throw error;
            }
        }
        
        async function displayUserData(userData) {
            try {
                const ip = await getIP();
                const userDataDiv = document.getElementById('userData');
                userDataDiv.innerHTML = `
                    <div class="data-item">
                        <div class="data-label">Name</div>
                        <div class="data-value">${userData.name}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Email</div>
                        <div class="data-value">${userData.email}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">IP Address</div>
                        <div class="data-value">${ip}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Gender</div>
                        <div class="data-value">${userData.gender}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Date of Birth</div>
                        <div class="data-value">${userData.dob}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Operating System</div>
                        <div class="data-value">${navigator.platform}</div>
                    </div>
                `;
                
                // Save user data to localStorage for auto-login simulation
                localStorage.setItem('userData', JSON.stringify(userData));
            } catch (error) {
                console.error('Failed to display user data:', error);
                showMessageBox('Failed to fetch user data');
            }
        }
        
        // Check for auto-login on page load
        window.addEventListener('load', async () => {
            try {
                const savedUserData = JSON.parse(localStorage.getItem('userData') || 'null');
                
                if (savedUserData) {
                    // Simulate IP check - in a real scenario, you would check against Google Sheets
                    const currentIp = await getIP();
                    
                    // For demo, 50% chance of matching IP
                    if (Math.random() > 0.5) {
                        // Auto login if IP matches
                        loginCard.classList.add('hidden');
                        userDataCard.classList.remove('hidden');
                        displayUserData(savedUserData);
                    }
                }
                
                // Initialize 3D background
                init3DBackground();
            } catch (error) {
                console.error('Auto-login failed:', error);
            }
        });
        
        // Get IP address function
        async function getIP() {
            const maxRetries = 3;
            let retryCount = 0;
            
            // 定义多个IP获取服务
            const ipServices = [
                'https://api.ipify.org?format=json',
                'https://ipapi.co/json/',
                'https://ipinfo.io/json',
                'https://api.ip.sb/ip'
            ];
            
            while (retryCount < maxRetries) {
                try {
                    // 随机选择一个IP服务
                    const serviceUrl = ipServices[Math.floor(Math.random() * ipServices.length)];
                    
                    // 设置超时
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(serviceUrl, {
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                        }
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // 从不同服务中提取IP地址
                    let ip = data.ip || data.IP || data.ip || null;
                    
                    // 验证IP地址格式
                    const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
                    if (ip && ipRegex.test(ip)) {
                        console.log(`Successfully retrieved IP: ${ip}`);
                        return ip;
                    } else {
                        throw new Error('Invalid IP format in response');
                    }
                    
                } catch (error) {
                    retryCount++;
                    console.error(`Attempt ${retryCount} failed:`, error.message);
                    
                    if (retryCount === maxRetries) {
                        console.error('Max retries reached. Could not get IP address.');
                        // 尝试使用本地IP检测作为最后手段
                        try {
                            const response = await fetch('https://httpbin.org/ip');
                            const data = await response.json();
                            if (data.origin) {
                                console.log(`Fallback IP: ${data.origin}`);
                                return data.origin;
                            }
                        } catch (fallbackError) {
                            console.error('Fallback IP detection failed:', fallbackError);
                        }
                        return 'Unknown';
                    }
                    
                    // 指数退避重试
                    const delay = Math.pow(2, retryCount) * 1000;
                    console.log(`Retrying in ${delay}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            return 'Unknown';
        }
        
        // 3D Background Initialization
        function init3DBackground() {
            // Check if Three.js is available
            if (typeof THREE === 'undefined') {
                console.error('Three.js is not loaded');
                return;
            }
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ 
                alpha: true,
                antialias: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('scene').appendChild(renderer.domElement);
            
            // Create different types of geometries
            const geometries = {
                core: new THREE.SphereGeometry(1, 32, 32),
                ai: new THREE.BoxGeometry(1, 1, 1),
                console: new THREE.CylinderGeometry(0.5, 0.5, 1, 32),
                particle: new THREE.OctahedronGeometry(0.5),
                network: new THREE.TorusGeometry(1, 0.3, 16, 100)
            };
            
            // Create materials - using blue color scheme
            const materials = {
                core: new THREE.MeshStandardMaterial({
                    color: 0x1e88e5,  // Deep blue
                    metalness: 0.8,
                    roughness: 0.2,
                    emissive: 0x1e88e5,
                    emissiveIntensity: 0.2
                }),
                ai: new THREE.MeshStandardMaterial({
                    color: 0x42a5f5,  // Medium blue
                    metalness: 0.6,
                    roughness: 0.4,
                    emissive: 0x42a5f5,
                    emissiveIntensity: 0.1
                }),
                console: new THREE.MeshStandardMaterial({
                    color: 0x64b5f6,  // Light blue
                    metalness: 0.9,
                    roughness: 0.1,
                    emissive: 0x64b5f6,
                    emissiveIntensity: 0.3
                }),
                particle: new THREE.MeshStandardMaterial({
                    color: 0x90caf9,  // Lighter blue
                    metalness: 0.4,
                    roughness: 0.6,
                    emissive: 0x90caf9,
                    emissiveIntensity: 0.2
                }),
                network: new THREE.MeshStandardMaterial({
                    color: 0x2196f3,  // Standard blue
                    metalness: 0.7,
                    roughness: 0.3,
                    emissive: 0x2196f3,
                    emissiveIntensity: 0.15
                })
            };
            
            const shapes = [];
            const numShapes = 15;
            
            // Create different types of shapes
            for (let i = 0; i < numShapes; i++) {
                const type = Object.keys(geometries)[Math.floor(Math.random() * Object.keys(geometries).length)];
                const shape = new THREE.Mesh(geometries[type], materials[type]);
                
                // Random position
                shape.position.x = Math.random() * 20 - 10;
                shape.position.y = Math.random() * 20 - 10;
                shape.position.z = Math.random() * 20 - 10;
                
                // Random rotation
                shape.rotation.x = Math.random() * Math.PI;
                shape.rotation.y = Math.random() * Math.PI;
                
                // Random scale
                const scale = 0.5 + Math.random() * 1.5;
                shape.scale.set(scale, scale, scale);
                
                // Add custom properties for animation
                shape.userData = {
                    rotationSpeed: {
                        x: (Math.random() - 0.5) * 0.02,
                        y: (Math.random() - 0.5) * 0.02,
                        z: (Math.random() - 0.5) * 0.02
                    },
                    floatSpeed: Math.random() * 0.001 + 0.001,
                    floatRange: Math.random() * 2 + 1
                };
                
                shapes.push(shape);
                scene.add(shape);
            }
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0x64b5f6, 0.4);  // Light blue ambient light
            scene.add(ambientLight);
            
            // Add directional light
            const directionalLight = new THREE.DirectionalLight(0x2196f3, 0.8);  // Standard blue directional light
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // Add point lights
            const pointLight1 = new THREE.PointLight(0x1e88e5, 1, 100);  // Deep blue point light
            pointLight1.position.set(5, 5, 5);
            scene.add(pointLight1);
            
            const pointLight2 = new THREE.PointLight(0x42a5f5, 1, 100);  // Medium blue point light
            pointLight2.position.set(-5, -5, -5);
            scene.add(pointLight2);
            
            // Add spotlight
            const spotLight = new THREE.SpotLight(0x64b5f6, 1);  // Light blue spotlight
            spotLight.position.set(0, 10, 0);
            spotLight.angle = Math.PI / 4;
            spotLight.penumbra = 0.1;
            spotLight.decay = 2;
            spotLight.distance = 200;
            scene.add(spotLight);
            
            camera.position.z = 15;
            
            // Mouse interaction
            let mouseX = 0;
            let mouseY = 0;
            
            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
            });
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                // Update camera position to follow mouse
                camera.position.x += (mouseX * 2 - camera.position.x) * 0.05;
                camera.position.y += (mouseY * 2 - camera.position.y) * 0.05;
                camera.lookAt(scene.position);
                
                // Update shapes
                shapes.forEach(shape => {
                    const userData = shape.userData;
                    
                    // Rotation
                    shape.rotation.x += userData.rotationSpeed.x;
                    shape.rotation.y += userData.rotationSpeed.y;
                    shape.rotation.z += userData.rotationSpeed.z;
                    
                    // Floating effect
                    const time = Date.now() * userData.floatSpeed;
                    shape.position.y += Math.sin(time + shape.position.x) * 0.01 * userData.floatRange;
                    
                    // Pulse effect
                    const scale = 1 + Math.sin(time * 2) * 0.1;
                    shape.scale.set(scale, scale, scale);
                });
                
                // Update lights
                const time = Date.now() * 0.001;
                pointLight1.position.x = Math.sin(time) * 10;
                pointLight1.position.z = Math.cos(time) * 10;
                pointLight2.position.x = Math.cos(time) * 10;
                pointLight2.position.z = Math.sin(time) * 10;
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
</body>
</html>                                                                                                           